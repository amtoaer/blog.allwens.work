---
title: jellyfin 基础教程
date: 2022-06-10 20:41:57
tags: ['jellyfin']
---

[jellyfin](https://jellyfin.org/) 是一个出色的本地媒体库管理工具，之前我素有耳闻，不过没有实际使用过。最近尝试用它管理本地 1T 机械硬盘里的资源，才发现自己过去的追番操作有多原始……于是我决定写篇文章记录一下我对 jellyfin 的摸索过程，也希望给刚刚接触这方面的萌新们一些微不足道的帮助。

<!--more-->

## 何谓本地媒体库管理？

首先介绍一下“本地媒体库管理”的概念。众所周知，视频文件下载完成后，只需要双击就能使用视频播放器播放，那为什么会需要“本地媒体库管理”呢？

请设想几个场景：

1. 下载完某个剧集，看了一阵子暂时搁置了，等再想看的时候忘记了追剧进度，只能从头看起。
2. 屯剧太多，打开视频列表发现密密麻麻的文件夹，看得头晕目眩。
3. 想要在其它设备方便地访问到自己的视频而无需复杂配置。

这些问题就是媒体库管理软件需要解决的。具体来说，一个媒体库管理软件的核心功能至少有：

1. 能够记录用户对视频的播放行为，可以随时续播；如有需要可以支持多用户。
2. 将若干文件夹抽象为媒体库，媒体库实时/定时更新；匹配文件夹内的视频文件，从开放的数据库中获取影片的封面、描述、评分、演职员表等信息，让剧集列表一目了然。
3. 采用前后端分离架构，后端可部署于任何主机，用于提供API。用户可在多端（ WEB 端、各平台的客户端）轻松接入。

## 如何安装？

大概介绍了媒体库管理的概念后，下面来简述 jellyfin 的安装方式。

> 因为我是在本机上使用 jellyfin，因此只介绍在 Windows 端的安装，其它平台原理一致。

### 后端

jellyfin 采用前后端分离，在 Windows 上安装推荐直接使用 [exe installer](https://repo.jellyfin.org/releases/server/windows/stable/)，这将安装 jellyfin 服务器，并自带一个易用的 WEB UI。安装过程中会提示选择安装模式，作为服务安装可以理解为开机自启动，作为可执行文件安装则是在手动运行时才启动服务器。

用户运行服务器后，可以打开 WEB UI（默认地址 localhost:8096）按照指引完成初始化操作。

### 客户端

既然 installer 已经自带了 WEB UI，为什么还需要自己安装客户端呢？

要知道，浏览器支持的视频格式比较有限。那么理所应当的，当浏览器播放不支持的视频格式时，需要由 jellyfin 服务器将视频转码成浏览器支持的格式，再交由浏览器解码，这会导致很多不必要的开销。因此推荐在本地安装一个客户端，让其承担全部解码工作。这样一方面可以降低服务器压力，一方面可以更加轻松地发挥硬件性能（硬解）。

[这里](https://jellyfin.org/clients/)是 jellyfin 官方列出的客户端列表，用户可以自由选择。

## 什么是刮削，以及如何提高刮削成功率？

安装完成并添加媒体库后，理论上你已经可以坐享其成了。只要更新剧集源文件，并等待 jellyfin 自动刷新元数据（也可手动刷新），源文件的更改就会被同步到 jellyfin 的媒体库中。然而，理想很丰满，现实很残酷。要想充分利用 jellyfin，你还是需要稍微介入剧集源文件的管理的。而原因就是刮削。

这个词看起来很深奥，但其实含义很简单。指的就是我上文中说的这一过程：

> 匹配文件夹内的视频文件，从开放的数据库中获取影片的封面、描述、评分、演职员表等信息。

通常情况下电影刮削成功率很高，所以主要介绍电视剧的情况。刮削失败大体分为两种：

1. 不能通过影片文件夹获取影片信息。
2. 不能通过影片文件获取季、集信息。

刮削失败后，jellyfin 内只能显示影片的原始文件夹或者原始文件名，且不会有相关图片、信息，会给体验造成很大影响。

由于刮削使用的开放数据库很靠谱，绝大部分刮削失败不应考虑数据库不全的问题，而是要从本地着手。刮削的匹配过程实际是以文件和文件夹的名称作为匹配依据的，所以不合理的源文件、源文件夹命名往往是刮削失败的罪魁祸首。虽然有时即使不对影片文件重命名也能成功刮削，但为了提高刮削成功率，还是推荐源文件采用如下的目录结构和命名（以夏日重现为例）：

```sh
夏日重现
└── S1
    ├── S01E01.mp4
    ├── S01E02.mp4
    ├── S01E03.mp4
    ├── S01E04.mp4
    ├── S01E05.mp4
    ├── S01E06.mp4
    ├── S01E07.mp4
    ├── S01E08.mp4
    └── S01E09.mp4
```

核心要点是：

1. 一级文件夹使用剧集的全名（原名或主流译名）
1. 二级文件夹是季度编号（以Season或S开头）
1. 三级文件是季度编号+集数编号

目前已经有了相应的[自动重命名工具](https://github.com/Nriver/Episode-ReName)，可以参考 README 使用以提高刮削成功率。

## 方便的番剧追更

[mikanani](https://mikanani.me/) 是一个十分方便的番剧下载网站，该站中番剧的每个发布组独享一个 rss 订阅连接。可以使用 bt 软件订阅 rss，并结合重命名工具完成整个追番工作流，这样不需任何人工介入，只需打开 jellyfin 即可看到最新的番剧更新。[auto bangumi ](https://github.com/EstrellaXD/Auto_Bangumi) 是一个使用该思路完成的全自动追番工具，有感兴趣的读者可以自行了解。如果读者更偏向于半自动管理，那可以参考如下步骤进行配置。

### 在 bt 软件中订阅番剧 rss

首先复制想要订阅番剧的 rss 链接：

![image-20220610231224611](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610231224611.png)

在 bt 软件（以 qbittorrent 为例）中订阅链接：

![image-20220610231407260](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610231407260.png)

设置下载规则：

![image-20220610231530310](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610231530310.png)

下载完自动重命名（下载完成后十五秒使用上面提到的自动重命名工具对下载目录进行一次自动重命名）：

![image-20220610231622066](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610231622066.png)

对文件进行重命名后，qbittorrent 会因文件丢失而无法做种。目前没有找到合理的解决方案，因此只能选择下载结束后删除种子，不进行做种了：

> 读者们如果有能够保种的方案可以评论这篇文章，只下载不做种的人是屑，我这是逼不得已……（悲

![image-20220610231958544](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610231958544.png)

参考上面的流程配置后，即可完成番剧自动追更。

## 截图

最后放几张 jellyfin 的截图吧！

主页：

![image-20220610233612750](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610233612750.png)

影视库：

![image-20220610233706642](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610233706642.png)

番剧介绍及季度划分：

![image-20220610233911189](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610233911189.png)

季度分集预览与简介：

![image-20220610233814130](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610233814130.png)

电影介绍：

![image-20220610234433844](https://rmt.ladydaily.com/fetch/allwens-work/storage/image-20220610234433844.png)
